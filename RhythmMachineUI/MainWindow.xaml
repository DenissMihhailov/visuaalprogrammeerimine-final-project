<Window x:Class="RhythmMachineUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:RhythmMachineUI"
        Title="Rhythm Machine" Width="1560" Height="410">

    <Window.Resources>
        <local:StepPlayheadBrushConverter x:Key="PlayheadBorder"
                                  Normal="#666666"
                                  Current="#000000"/>

        <local:StepPlayheadBrushConverter x:Key="PlayheadBg"
                                  Normal="#22FFFFFF"
                                  Current="#FF000000"/>

    </Window.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="10"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                <TextBlock Text="Pattern:" VerticalAlignment="Center" Margin="0,0,8,0"/>

                <ComboBox Width="240"
                          ItemsSource="{Binding Patterns}"
                          SelectedItem="{Binding SelectedPattern}"
                          DisplayMemberPath="DisplayName"/>

                <Button Content="Save Pattern As" Margin="8,0,0,0" Padding="10,6"
                        Command="{Binding SavePatternAsCommand}"/>

                <Button Content="Delete Pattern" Margin="8,0,0,0" Padding="10,6"
                        Command="{Binding DeletePatternCommand}"/>
                
                <Button Content="Export CSV" Margin="8,0,0,0" Padding="10,6"
                        Command="{Binding ExportPatternCsvCommand}"/>


                <TextBlock Text="Kit:" VerticalAlignment="Center" Margin="18,0,8,0"/>

                <ComboBox Width="240"
                          ItemsSource="{Binding Kits}"
                          SelectedItem="{Binding SelectedKit}"
                          DisplayMemberPath="DisplayName"/>

                <Button Content="Save Kit As" Margin="8,0,0,0" Padding="10,6"
                        Command="{Binding SaveKitAsCommand}"/>

                <Button Content="Delete Kit" Margin="8,0,0,0" Padding="10,6"
                        Command="{Binding DeleteKitCommand}"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center">
                <TextBlock Text="BPM:" VerticalAlignment="Center" Margin="16,0,8,0"/>
                <TextBox Width="70" Text="{Binding BpmText, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Vol:" VerticalAlignment="Center" Margin="18,0,8,0"/>
                <Slider Width="160" Minimum="0" Maximum="1" Value="{Binding Volume, UpdateSourceTrigger=PropertyChanged}"/>

                <Button Content="Play" Margin="18,0,0,0" Padding="14,6"
                        Command="{Binding PlayCommand}"/>

                <Button Content="Stop" Margin="8,0,0,0" Padding="14,6"
                        Command="{Binding StopCommand}"/>
            </StackPanel>
        </DockPanel>

        <Border Grid.Row="2" BorderBrush="#333" BorderThickness="1" CornerRadius="10" Padding="10">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Rows}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <DockPanel Margin="0,0,0,10">
                                <TextBlock Width="90" Text="{Binding Role}" VerticalAlignment="Center"/>

                                <ComboBox Width="220" Margin="0,0,10,0"
                                          ItemsSource="{Binding Sounds}"
                                          SelectedItem="{Binding SelectedSound}"
                                          DisplayMemberPath="Name"/>

                                <ItemsControl ItemsSource="{Binding Steps}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <UniformGrid Rows="1" Columns="16"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>

                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <ToggleButton Width="42"
                                                          Height="30"
                                                          IsChecked="{Binding IsOn, Mode=TwoWay}"
                                                          Command="{Binding DataContext.ToggleCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                          CommandParameter="{Binding}">

                                                <ToggleButton.BorderBrush>
                                                    <MultiBinding Converter="{StaticResource PlayheadBorder}">
                                                        <Binding Path="StepIndex"/>
                                                        <Binding Path="DataContext.CurrentStep" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                        <Binding Path="DataContext.IsPlaying" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                    </MultiBinding>
                                                </ToggleButton.BorderBrush>

                                                <ToggleButton.Background>
                                                    <MultiBinding Converter="{StaticResource PlayheadBg}">
                                                        <Binding Path="StepIndex"/>
                                                        <Binding Path="DataContext.CurrentStep" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                        <Binding Path="DataContext.IsPlaying" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                                    </MultiBinding>
                                                </ToggleButton.Background>

                                                <ToggleButton.Style>
                                                    <Style TargetType="ToggleButton">
                                                        <Setter Property="Margin" Value="3"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                        <Setter Property="BorderBrush" Value="#666"/>
                                                        <Setter Property="Background" Value="#1AFFFFFF"/>


                                                        <Style.Triggers>

                                                            <Trigger Property="IsChecked" Value="True">
    <Setter Property="Background" Value="#33FFFFFF"/>
    <Setter Property="BorderBrush" Value="#888"/>
</Trigger>


                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#11FFFFFF"/>
                                                            </Trigger>

                                                            <DataTrigger Binding="{Binding StepIndex}" Value="4">
                                                                <Setter Property="Margin" Value="18,3,3,3"/>
                                                                <Setter Property="BorderThickness" Value="4,2,2,2"/>
                                                                <Setter Property="BorderBrush" Value="#666"/>
                                                            </DataTrigger>

                                                            <DataTrigger Binding="{Binding StepIndex}" Value="8">
                                                                <Setter Property="Margin" Value="18,3,3,3"/>
                                                                <Setter Property="BorderThickness" Value="4,2,2,2"/>
                                                                <Setter Property="BorderBrush" Value="#666"/>
                                                            </DataTrigger>

                                                            <DataTrigger Binding="{Binding StepIndex}" Value="12">
                                                                <Setter Property="Margin" Value="18,3,3,3"/>
                                                                <Setter Property="BorderThickness" Value="4,2,2,2"/>
                                                                <Setter Property="BorderBrush" Value="#666"/>
                                                            </DataTrigger>

                                                        </Style.Triggers>
                                                    </Style>
                                                </ToggleButton.Style>

                                            </ToggleButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DockPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

    </Grid>
    
    
</Window>
